<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html lang="en">
	<head>
		<title>PiCar</title>
		<meta charset="utf-8" />
		
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="is-preload">

		<!-- Header -->
			<section id="header">
				<header>
					<h1 id="logo"><a href="#"> <img src="img/picar_logo.png" style="
						width: 50px;" alt="Picar" /> </a> </h1>
					<h1>ECE 5725: Final Project </h1>	
					<div style="height: 10px"></div>				
					<h3 style="margin: 0px;" >	<a href="https://www.linkedin.com/in/an23334/" class="icon brands fa-linkedin"><span class="label">Linkendin-Anthony</span></a> Anthony Ngoma </h3>
					<h3 style="margin: 0px;" > <a href="https://www.linkedin.com/in/atsutse/" class="icon brands fa-linkedin"><span class="label">Linkendin-Tsetse</span></a> Atsutse Kludze </h3>
					<h5> December. 17th </h5>
				</header>
				<nav id="nav">
					<ul>
						<li><a href="#one" class="active">Introduction</a></li>
						<li><a href="#two">Objective</a></li>
						<li><a href="#three">Design and Testing</a></li>
						<li><a href="#four">Results</a></li>
						<li><a href="#five">Conclusions</a></li>
						<li><a href="#six">Appendices</a></li>
						<li><a href="#seven">Code</a></li>
					</ul>
				</nav>
				<footer>
					<ul class="icons">
						<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon brands fa-github"><span class="label">Github</span></a></li>
						<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
					</ul>
				</footer>
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">

						<!-- One -->
							<section id="one">									
								<div class="container">
									<header class="major">
										<h2>PiCar</h2>
										<p>A client-server application for interfacing with a remote RPi robot to control it or to find objects autonomously.</p>
		
										<h4>Main Features</h4>
										<ul class="feature-icons">
											<li class="icon solid fa-terminal">SSH Tunneling</li>
											<li class="icon solid fa-video">Real Time Video Feedback</li>
											<li class="icon solid fa-search">Autonomous Search</li>
											<li class="icon solid fa-gamepad">Remote Control</li>
											<li class="icon solid fa-laptop">Web Interface</li>
											<li class="icon solid fa-eye">Object Detection</li>

										</ul>
									</header>
								</div>
							</section>

						<!-- Two -->
							<section id="two">
								<div class="container">
									<h3>Objective</h3>
									<p>
										The inspiration of this project came from the ece4725 lab3 when we could not control the robot remotely.
										Another inspiration was the different control/search mission robots in emergency situations.
										The primary goal of PiCar is to have an interface where users do not have to be <b>directly next to</b> the RPi robot to send commands.  
										From this remote interface, the PiCar offers two main features: remote control mode and remote automous mode, allowing any user to 
										give instructions remotely after authenticating. 
									</p>
								</div>
							</section>

						<!-- Three -->
							<section id="three">
								<div class="container">
									<h3>Design and Testing</h3>
									<h5>Software</h5>
									<h5> Interface Scripts</h5>
									<section>
										<p>
											We have decided to build two main scripts as entry points to launching PiCar, one to launch the PiCar server and the other to authenticate the client. 
											These scripts' roles are to: start the Flask webserver and make sure ssh tunneling is established between the server and the client ports through the class' server. 
											Since both students were working remotely, we relied on the class' public IP to do port forawrding (ssh tunneling). 
										</p>

										<ul>
											<li> <b> Server.sh</b>: Starting point for launching PiCar website and creating ssh tunneling ports.</li>
											<li> <b> Client.sh</b>: Allowing the user to forward requests through ssh tunneling.</li>
											<li> <b> Clean.sh</b>: Freeing any used PiCar ports for the user to use.</li>
										</ul>
										<figure>
											<figcaption> <b> <u>Figure 1: Server Response through Classs' IP. </u></b> </figcaption>
											<img src="img/server_response.svg" alt="serverResponse" />
										</figure>
										<p>
											The first main script -- <b>server.sh</b> -- sets up the website and creates a port on the class' public server in order to do ssh tunneling to give authenticated remote users access to the website. 
										</p>
										<p>							
											Regarding the ssh tunneling, the server exposes two ports (port=8888 and port=9999) (as show in <b>figure 1</b>) by creating a connection on two remote ports (port=8888 and port=9999 respectively). 
											On the server RPi, we have two servers running. These two ports exposes the camera server and the website server. 
											We seperated these into two servers in order for us to create different processes and allow multi-process systems that can provide 
											a smooth real time video feedback system for remote control mode. 
											From these two port connections, any authenticated users sending requests from the class' server will be able to access the RPi's website and camera. 
										</p>

										<figure>
											<figcaption> <b> <u>Figure 2: Client Request through Class' IP. </u></b> </figcaption>
											<img src="img/client_request.svg" alt="clientRequest" />
										</figure>
										<p>
											The second main script -- <b>client.sh</b> -- has only one job which is to allow the user to forward any localhost requests to the class' server ports. 
											In order for us to switch roles as servers and clients, we decided to create four ports on the class' server.
											Since each student has their own RPis and camera, we were able to control each others robots through ssh tunneling.    
										</p>
										<p>							
											Regarding the ssh tunneling, the server exposes two ports -- port=8888 and port=9999 -- (as show in <b>figure 2</b>) by creating a connection on two remote ports (port=8888 and port=9999 respectively). 
											From these two port connections, any remote clients can access the server RPi.   
										</p>
										<p>
											The last script -- <b>clean.sh</b> -- was created to allow the user to kill and free any ports that PiCar will need before running client.sh or server.sh. 
											This has made development super fast since we relied on an automated way to free ports. One other option that we looked into is adding input parameters to these scripts 
											to allow the user to change these ports. Since this is a prototype, we did not see the value of adding such support at this time. 
										</p>

										<p>
											<b>KEY POINTS on ssh tunneling: </b>		
											<br />- To have a successful connection, the client HASH to connect to the same ports as the server namely port=8888 and port=9999 in order to access RPi server's website and camera. 
											<br />- To avoid any conflicts with port on the class' server, a new server needs to create new ports (instead of port=8888 and port=9999 ). 
											<br />- To stop the ssh tunnel from "HANGING UP", add "-fNR or -fNL" to put keep these connections in background and free the RPi's shell.  
										</p>
									</section>

									<h5> Web Server</h5>
									<section>
										<p>
										The web server uses python Flask app for the backend and relies on CSS, HTML, Jquery, and JS for the frontend. 
										The frontend has 3 main pages: home, control, and autonomous as shown below. 
										</p>
										<figure>
											<figcaption> <b> <u>Figure 3: PiCar Home Page. </u></b> </figcaption>
											<img class="image" src="img/home_page.png" alt="PiCar's Home Page" />
										</figure>

										<figure>
											<figcaption> <b> <u>Figure 4: PiCar Control Page. </u></b> </figcaption>
											<img class="image" src="img/control_page.png" alt="PiCar's Control Page" />
										</figure>

										<figure>
											<figcaption> <b> <u>Figure 5: PiCar Auto Page. </u></b> </figcaption>
											<img class="image" src="img/auto_page.png" alt="PiCar's Auto Page" />
										</figure>

										<p>
											To connect these pages to the server RPi, the backend of the webserver supports and exposes 9 endpoints:    
										</p>
										<ul>
											<li> <b> @app.route('/') </b>: returns the main page of the PiCar site namely <b>index.html</b></li>
											<li> <b> @app.route('/control') </b>: return the control page of the PiCar webiste namely <b>control.html</b></li>
											<li> <b> @app.route('/auto')</b>: return the autonomous page of the PiCar webiste namely <b>auto.html</b></li>
											<li> <b> @app.route('/robot_front')</b>: entry point to command the server robot to move forward. </li>
											<li> <b> @app.route('/robot_back')</b>: entry point to command the server robot to move backward.</li>
											<li> <b> @app.route('/robot_right')</b>: entry point to command the server robot to move to the right.</li>
											<li> <b> @app.route('/robot_left')</b>: entry point to command the server robot to move to the leff.</li>
											<li> <b> @app.route('/robot_stop')</b>: entry point to command the server robot to stop. </li>
											<li> <b> @app.route('/uploader')</b>: given an image, this endpoint enables server robot to start auto search then returns ONLY after the item was found.</li>
										</ul>

									</section>

									<h5> Camera Server</h5>
									<section>
										<p>
											For control mode, the camera frame rate and latency is crucial. As the client relies on the website to control the robot remotely, 
											any latency can affect the user experience. To resolve this issue and have a fast real time video feedback system, the control page relies on both the web server and camera server. 
											These are two seperate processes running on the raspberry pi. Through context switching, each process will run as if it was the only one running thus decreasing any latency. 		
										</p>
										<p>
											If the client decides to control the RPi server robot and navigates to the PiCar control page, the '\control' endpoint on the webserver will
											create a new process (if one already does not exists) of the camera server. Using Python os package, the webserver starts the camera server, puts it in the background, and save its PID. 
											Later on, if the client switches mode (clicks on the autonomous tab), the webserver from the "/auto" endpoint kills the camera process. 
											<b>With limited resources (one camera), the server RPi cannot use the camera for both control and autonmous logic;</b> therefore, the camera process gets killed which frees the camera for the auto mode logic.
											We have considered merging the logics for auto and control in order to eliminate the need of creating and deleting the camera process; however, 
											due to the limited amount of time we had, we decided to have a working propotype that could always be improved. 
										</p>

										<p>
											The current camera server relies on the Python picamera library and uses a buffer to load different frames on a server. 
											This server runs at port=8000 and exposes endpoints to retrieve frames as the server captures images from the RPi camera. 
											This setup is very simple since we do not have to directly confifgure the RPi camera and can just rely on the picamera library after specificying 
											options such as framerate. All of this code will then run in a particular process and the website can access the server by sending get requests to localhost:8000 which where the camera server is running.  
										</p>

									</section>
								
									<h5> Robot Control</h5>
									<section>

									</section>

									<h5> Robot Detection</h5>
									<section>
									</section>

									<h5>Hardware</h5>

									<h5> Camera Setup</h5>
									<section>
									</section>

									<h5> Motors Setup</h5>
									<section>
									</section>
								</div>
							</section>

						<!-- Four -->
							<section id="four">
								<div class="container">
									<h3>Results</h3>
									
								</div>
							</section>


							<!-- Five -->
							<section id="five">
								<div class="container">
									<h3>Conclusions</h3>
							
								</div>
							</section>

							<!-- Six -->
							<section id="six">
								<div class="container">
									<h3>Appendices</h3>

									<h5>Future Work</h5>
									<section>


									</section>

									<h5>Budget</h5>
									<section>


									</section>

									<h5>References</h5>
									<section></section>
								</div>
							</section>

							<!-- Seven -->
							<section id="seven">
								<div class="container">
									<h3>Code</h3>
									<p>Our full repository of source code for PiCar can be found  <a href="https://github.com/anthony23334/PiCar">here</a> </p>
									<p>
										App.py - handles endpoinnts and starts camera server. 
										<script src="https://gist.github.com/anthony23334/1f450f6066cee18e8900405af90e2426.js"></script>
									</p>

									<p>
										robot_control.py - controls the robot movement.  
										<script src="https://gist.github.com/anthony23334/38819ed862e456a464f9dc30601dc509.js"></script>
									</p>

									<p>
										robot_detection.py - starts the camera and runs search algorithm.  
										<script src="https://gist.github.com/anthony23334/fad1dd8e27508c1a8d68b2f7e7d7740d.js"></script>
									</p>

								</div>
							</section>

					
					</div>

				<!-- Footer -->
					<section id="footer">
						<div class="container">
							<ul class="copyright">
								<li>ECE 5725 Cornell University, 2020</li>
							</ul>
						</div>
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>